Version 4
SHEET 1 2840 836
WIRE 960 -320 -256 -320
WIRE -256 -112 -256 -320
WIRE -48 -112 -256 -112
WIRE 288 -112 -48 -112
WIRE 368 -112 288 -112
WIRE 496 -112 448 -112
WIRE 768 -112 496 -112
WIRE 960 -112 960 -320
WIRE 1344 -112 960 -112
WIRE 1952 -112 1344 -112
WIRE 288 -16 288 -112
WIRE 496 -16 496 -112
WIRE 768 -16 768 -112
WIRE -48 16 -48 -112
WIRE 496 96 496 64
WIRE 768 96 768 48
WIRE 768 96 496 96
WIRE 288 112 288 64
WIRE 288 112 208 112
WIRE -256 128 -256 -112
WIRE 1344 144 1344 -112
WIRE 1856 144 1792 144
WIRE 208 160 208 112
WIRE 208 160 192 160
WIRE 288 160 288 112
WIRE 432 160 288 160
WIRE 768 160 768 96
WIRE 768 160 592 160
WIRE 960 160 960 -112
WIRE 1856 160 1856 144
WIRE -48 176 -48 96
WIRE 64 176 -48 176
WIRE 128 176 112 176
WIRE 528 176 480 176
WIRE 544 176 528 176
WIRE 208 192 192 192
WIRE 656 192 592 192
WIRE 288 208 288 160
WIRE -48 240 -48 176
WIRE 1792 240 1792 144
WIRE 960 256 960 240
WIRE 1248 256 960 256
WIRE 64 272 64 176
WIRE 208 272 208 192
WIRE 208 272 64 272
WIRE 432 288 432 160
WIRE 656 288 656 192
WIRE 656 288 432 288
WIRE 1344 288 1344 224
WIRE 1344 288 1216 288
WIRE 1504 288 1344 288
WIRE 1728 288 1584 288
WIRE 1216 304 1216 288
WIRE 1248 304 1248 256
WIRE 1792 384 1792 336
WIRE 1952 384 1952 -112
WIRE 1952 384 1792 384
WIRE 960 416 960 256
WIRE -48 432 -48 320
WIRE 112 432 112 176
WIRE 112 432 -48 432
WIRE 288 432 288 288
WIRE 288 432 112 432
WIRE 480 432 480 176
WIRE 480 432 288 432
WIRE 1232 464 1232 368
WIRE 1856 464 1856 240
WIRE 480 480 480 432
WIRE 960 512 960 496
FLAG 480 480 0
FLAG -256 208 0
FLAG 768 -112 Vref
FLAG 960 512 0
FLAG 1232 464 0
FLAG 1856 528 0
SYMBOL res -64 0 R0
SYMATTR InstName R1
SYMATTR Value 10k
SYMBOL res -64 224 R0
SYMATTR InstName R2
SYMATTR Value 31.25k
SYMBOL res 272 -32 R0
SYMATTR InstName R3
SYMATTR Value 10
SYMBOL res 272 192 R0
SYMATTR InstName R4
SYMATTR Value 17.85k
SYMBOL res 480 -32 R0
SYMATTR InstName R5
SYMATTR Value 2k
SYMBOL res 464 -128 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R6
SYMATTR Value 650
SYMBOL LED 752 -16 R0
SYMATTR InstName LED1
SYMBOL res 944 400 R0
SYMATTR InstName R7
SYMATTR Value 15.625k
SYMBOL res 944 144 R0
SYMATTR InstName R8
SYMATTR Value 10k
SYMBOL res 1328 128 R0
SYMATTR InstName R9
SYMATTR Value 2.2k
SYMBOL res 1600 272 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R10
SYMATTR Value 220k
SYMBOL res 1872 256 R180
WINDOW 0 -57 92 Left 2
WINDOW 3 -43 50 Left 2
SYMATTR InstName R11
SYMATTR Value 1k
SYMBOL LED 1840 464 R0
SYMATTR InstName LED2
SYMBOL voltage -256 112 R0
WINDOW 3 -138 143 Left 2
WINDOW 123 0 0 Left 0
WINDOW 39 24 72 Left 2
SYMATTR Value PULSE(0 3.6 0 0 0 1 0 0)
SYMATTR InstName V1
SYMBOL pnp 1728 240 R0
SYMATTR InstName Q3
SYMATTR Value 2N3906
SYMBOL AutoGenerated\\TL431_8inch 160 176 R0
SYMATTR InstName U1
SYMBOL AutoGenerated\\TL431_8inch 560 176 R0
SYMATTR InstName U2
SYMBOL AutoGenerated\\TL431_8inch 1232 336 R270
SYMATTR InstName U3
TEXT -288 296 Left 2 !.tran 1
TEXT -208 560 Left 2 ;3.9V < V1 < 3.3V (D1 turns ON if V1 is out of this boundary)
TEXT -200 616 Left 2 ;R2 and R4 can be tweaked to adjust thresholds
TEXT -200 664 Left 2 ;ex: Vtrigger = 3.3V = (1+ R1/R2)*Vref  ;R1=10K; R2=31.25K ;Vref = 2.5V for TL431
TEXT 1216 568 Left 2 ;D2 turns ON if V1 > 4.1V
TEXT 1216 616 Left 2 ;Vtrigger = (1+R8/R7)*Vref  => 4.1 = (1+10k/R7)*2.5
TEXT 1216 664 Left 2 ;Measure current through D1, D2 to check for turn ON condition
